---
- name: Install miniDNLA
  apt:
    name: minidlna
    state: present

- name: Ensure that configured cache dir exists
  file:
    path: "{{ minidlna.db_dir }}"
    state: directory
    owner: "{{ minidlna.user }}"
    group: "{{ minidlna.group }}"
    mode: 0755

- name: Copy miniDLNA configuration in place.
  template:
    src: minidlna.conf.j2
    dest: /etc/minidlna.conf
    owner: root
    group: root
    mode: 0644

- name: Copy default configuration
  template:
    src: minidlna.default.j2
    dest: /etc/default/minidlna
    owner: root
    group: root
    mode: 0644

- name: Ensure miniDLNA is restarted and enabled to start at boot.
  service:
    name: minidlna
    state: restarted
    enabled: yes
